# MySQL 8.0 Configuration - Production VPS Simulation
# Simulates: Hostinger/DonWeb/DigitalOcean Standard Droplet
# Hardware: 1 vCPU, 1.5GB RAM

[mysqld]

# ═══════════════════════════════════════════════════════════════
# CONNECTION LIMITS (Strict Standard VPS)
# ═══════════════════════════════════════════════════════════════
max_connections = 150                    # Standard shared hosting limit
max_connect_errors = 10000               # Prevent lockouts during testing
wait_timeout = 60                        # Aggressive cleanup (1 minute)
interactive_timeout = 60                 # Match wait_timeout
connect_timeout = 10                     # Connection handshake timeout

# ═══════════════════════════════════════════════════════════════
# MEMORY ALLOCATION (Fit within 1.5GB total RAM)
# ═══════════════════════════════════════════════════════════════
# Buffer Pool: ~67% of available RAM for InnoDB
innodb_buffer_pool_size = 1G             # Primary cache (leave 512MB for OS/other)
innodb_buffer_pool_instances = 1         # Single core = single instance
innodb_log_buffer_size = 16M             # Transaction log buffer

# Query Cache (disabled in MySQL 8.0, but set for compatibility)
# query_cache_size = 0                   # Disabled in MySQL 8.0+

# Per-connection buffers (multiply by max_connections = 150)
sort_buffer_size = 256K                  # 150 * 256K = 38MB
read_buffer_size = 128K                  # 150 * 128K = 19MB
read_rnd_buffer_size = 256K              # 150 * 256K = 38MB
join_buffer_size = 256K                  # 150 * 256K = 38MB

# ═══════════════════════════════════════════════════════════════
# PERFORMANCE TUNING (Single CPU)
# ═══════════════════════════════════════════════════════════════
innodb_thread_concurrency = 2            # 2x vCPU count (1 core)
innodb_read_io_threads = 2               # Minimal for single core
innodb_write_io_threads = 2              # Minimal for single core
thread_cache_size = 16                   # Cache threads to reduce overhead

# ═══════════════════════════════════════════════════════════════
# TRANSACTION & LOCKING
# ═══════════════════════════════════════════════════════════════
innodb_lock_wait_timeout = 10            # Fail fast on deadlocks
innodb_flush_log_at_trx_commit = 2       # Performance vs durability tradeoff
innodb_flush_method = O_DIRECT           # Bypass OS cache

# ═══════════════════════════════════════════════════════════════
# LOGGING & MONITORING
# ═══════════════════════════════════════════════════════════════
slow_query_log = 1                       # Enable slow query log
slow_query_log_file = /var/log/mysql/slow-query.log
long_query_time = 2                      # Log queries > 2 seconds
log_error = /var/log/mysql/error.log
log_error_verbosity = 2                  # Warnings and errors

# ═══════════════════════════════════════════════════════════════
# LIMITS & SAFETY
# ═══════════════════════════════════════════════════════════════
max_allowed_packet = 64M                 # Maximum packet size
tmp_table_size = 32M                     # Temporary table size
max_heap_table_size = 32M                # Match tmp_table_size

# ═══════════════════════════════════════════════════════════════
# CHARACTER SET
# ═══════════════════════════════════════════════════════════════
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# ═══════════════════════════════════════════════════════════════
# TIMEZONE
# ═══════════════════════════════════════════════════════════════
default-time-zone = '-03:00'             # Argentina timezone

[mysql]
default-character-set = utf8mb4

[client]
default-character-set = utf8mb4
